# GitHub Actions å·¥ä½œæµé…ç½®æ–‡ä»¶
# ç”¨äºè‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½² React åº”ç”¨åˆ° GitHub Pages
name: ğŸš€ Deploy to GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šå½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æˆ–åˆ›å»ºé’ˆå¯¹ main åˆ†æ”¯çš„ PR æ—¶è§¦å‘
on:
  push:
    branches: [ main ]  # æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  pull_request:
    branches: [ main ]  # åˆ›å»ºé’ˆå¯¹ main åˆ†æ”¯çš„ PR æ—¶è§¦å‘

# è®¾ç½® GITHUB_TOKEN æƒé™
# è¿™äº›æƒé™æ˜¯ GitHub Pages éƒ¨ç½²æ‰€å¿…éœ€çš„
permissions:
  contents: read      # è¯»å–ä»“åº“å†…å®¹æƒé™
  pages: write        # å†™å…¥ GitHub Pages æƒé™
  id-token: write     # å†™å…¥ ID token æƒé™ï¼ˆç”¨äºèº«ä»½éªŒè¯ï¼‰

# å¹¶å‘æ§åˆ¶ï¼šç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªéƒ¨ç½²ä»»åŠ¡è¿è¡Œ
# é˜²æ­¢å¤šä¸ªéƒ¨ç½²ä»»åŠ¡åŒæ—¶æ‰§è¡Œé€ æˆå†²çª
concurrency:
  group: "pages"              # å¹¶å‘ç»„åç§°
  cancel-in-progress: false   # ä¸å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„éƒ¨ç½²

# å®šä¹‰å·¥ä½œæµä»»åŠ¡
jobs:
  # æ„å»ºä»»åŠ¡ï¼šè´Ÿè´£ä»£ç æ£€æŸ¥ã€ä¾èµ–å®‰è£…å’Œé¡¹ç›®æ„å»º
  build-and-deploy:
    runs-on: ubuntu-latest    # åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œ
    
    steps:
    # æ­¥éª¤ 1: æ£€å‡ºä»£ç 
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4  # ä½¿ç”¨å®˜æ–¹ checkout action æ£€å‡ºä»£ç 
      
    # æ­¥éª¤ 2: è®¾ç½® Node.js ç¯å¢ƒ
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4  # ä½¿ç”¨å®˜æ–¹ Node.js setup action
      with:
        node-version: '18'         # æŒ‡å®š Node.js ç‰ˆæœ¬ä¸º 18
        cache: 'yarn'              # å¯ç”¨ yarn ç¼“å­˜ä»¥åŠ é€Ÿä¾èµ–å®‰è£…
        
    - name: ğŸ“¦ Install dependencies
      run: yarn install --frozen-lockfile  # ä½¿ç”¨ yarn å®‰è£…ä¾èµ–ï¼Œ--frozen-lockfile ç¡®ä¿ç‰ˆæœ¬é”å®š
      
    # æ­¥éª¤ 4: æ„å»ºé¡¹ç›®
    - name: ğŸ”¨ Build
      run: yarn build              # æ‰§è¡Œæ„å»ºå‘½ä»¤
      env:
        NODE_ENV: production       # è®¾ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
        GITHUB_ACTIONS: true       # æ ‡è¯†å½“å‰åœ¨ GitHub Actions ä¸­è¿è¡Œ
      
    # æ­¥éª¤ 5: åˆ—å‡ºæ„å»ºè¾“å‡ºæ–‡ä»¶ï¼ˆç”¨äºè°ƒè¯•ï¼‰
    - name: ğŸ“ List build output
      run: ls -la dist/            # æ˜¾ç¤º dist ç›®å½•å†…å®¹ï¼Œç¡®è®¤æ„å»ºæˆåŠŸ
      
    # æ­¥éª¤ 6: ä¸Šä¼ æ„å»ºäº§ç‰©
    - name: ğŸ“ Upload artifact
      uses: actions/upload-pages-artifact@v3  # ä¸Šä¼ æ„å»ºäº§ç‰©åˆ° GitHub Pages
      with:
        path: ./dist               # æŒ‡å®šè¦ä¸Šä¼ çš„ç›®å½•è·¯å¾„
      
  # éƒ¨ç½²ä»»åŠ¡ï¼šè´Ÿè´£å°†æ„å»ºäº§ç‰©éƒ¨ç½²åˆ° GitHub Pages
  deploy:
    environment:
      name: github-pages           # ç¯å¢ƒåç§°
      url: ${{ steps.deployment.outputs.page_url }}  # éƒ¨ç½²åçš„é¡µé¢ URL
    runs-on: ubuntu-latest         # åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œ
    needs: build-and-deploy        # ä¾èµ–æ„å»ºä»»åŠ¡å®Œæˆåæ‰æ‰§è¡Œ
    if: github.ref == 'refs/heads/main'  # åªåœ¨ main åˆ†æ”¯ä¸Šæ‰§è¡Œéƒ¨ç½²ï¼ˆPR ä¸éƒ¨ç½²ï¼‰
    
    steps:
    # æ­¥éª¤ 1: éƒ¨ç½²åˆ° GitHub Pages
    - name: ğŸš€ Deploy to GitHub Pages
      id: deployment               # æ­¥éª¤ IDï¼Œç”¨äºè¾“å‡º URL
      uses: actions/deploy-pages@v4  # ä½¿ç”¨å®˜æ–¹ GitHub Pages éƒ¨ç½² action 